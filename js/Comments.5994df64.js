(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Comments"],{"0bef":function(e,o,t){"use strict";t.r(o);var s=t("7a23");const n=["onClick"];function i(e,o,t,i,c,m){return Object(s["s"])(),Object(s["f"])("div",null,[Object(s["G"])(Object(s["g"])("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>c.comment=e),onKeypress:o[1]||(o[1]=Object(s["H"])((...e)=>m.addComment&&m.addComment(...e),["enter"]))},null,544),[[s["D"],c.comment]]),Object(s["g"])("button",{onClick:o[2]||(o[2]=(...e)=>m.addComment&&m.addComment(...e))},"Добавить комментарий"),Object(s["g"])("ul",null,[(Object(s["s"])(!0),Object(s["f"])(s["a"],null,Object(s["y"])(c.comments,e=>(Object(s["s"])(),Object(s["f"])("li",{key:e.id},[Object(s["g"])("span",null,Object(s["B"])(e.text),1),Object(s["g"])("span",null,[Object(s["g"])("button",{onClick:o=>m.removeComment(e.id)},"удалить",8,n)])]))),128))])])}class c{constructor(e){this.pool=[],this.timeouts=[],this.url=e,this.WSObj=null,this.connected=!1}connect(){this.WSObj=new WebSocket(this.url),this.WSObj.onopen=this.onOpen.bind(this),this.WSObj.onclose=this.onClose.bind(this),this.WSObj.onerror=this.onError.bind(this),this.WSObj.onmessage=this.onMessage.bind(this)}onError(e){console.log("Error:",e);const o=this.pool.findIndex(o=>o.message===e.data);if(o>-1){this.pool[o].onError(e);const t=this.pool[o].TMID;null!==t&&clearTimeout(t),this.pool.splice(o,1)}}onMessage(e){console.log("Message:",e);const o=this.pool.findIndex(o=>o.message===e.data);if(o>-1){const t=this.pool[o];if(t.onSuccess(e),t.timeout){const e=this.timeouts.findIndex(e=>e.messageId===t.messageId);e>-1&&(clearTimeout(this.timeouts[e].timeoutId),this.timeouts.splice(e,1))}this.pool.splice(o,1)}}onOpen(){console.log("Connected"),this.connected=!0}onClose(e){e.wasClean?console.log("Closed"):console.log("Broken"),this.connected=!1}sendMessage(e){if(this.connected){if(this.WSObj.send(e.message),e.timeout){const o=setTimeout(()=>{this.removeFromPoolById(e.messageId),console.log("TIMEOUTED",e.message)},e.timeout);this.timeouts.push({messageId:e.messageId,timeoutId:o})}this.pool.push(e)}else console.error("Socket not connected")}removeFromPoolById(e){const o=this.pool.findIndex(o=>o.messageId===e);o&&this.pool.splice(o,1)}disconnect(){this.WSObj.close()}}class m{constructor({message:e="",onSuccess:o,onError:t,timeout:s=0}={}){this.messageId=Math.round(Date.now()*Math.random()),this.message=e,this.onSuccess="function"===typeof o?o:()=>{},this.onError="function"===typeof t?t:()=>{},this.timeout=s}}var d={name:"Comments",data(){return{comments:[{id:"1",text:"Тестовый коммент 1"},{id:"2",text:"Это шедевр"},{id:"3",text:"Это прекрасно"},{id:"4",text:"Лучшее, что я видел"},{id:"5",text:"Два чая этому автору"}],comment:"",socketMessenger:new c("wss://ws.ifelse.io")}},mounted(){this.socketMessenger.connect()},beforeDestroy(){this.socketMessenger.disconnect()},methods:{removeComment(e){this.socketMessenger.sendMessage(new m({message:e,onSuccess:o=>{const t=this.comments.findIndex(o=>o.id===e);t>-1&&this.comments.splice(t,1),console.log("Removed:",o.data)},onError:e=>{console.log("remove comment error:",e)},timeout:500}))},addComment(){this.socketMessenger.sendMessage(new m({message:this.comment,onSuccess:e=>{this.comments.push({id:String(Math.round(1e4*Math.random())),text:e.data}),this.comment=""},onError:e=>{console.log("add comment error:",e)}}))}}},r=t("6b0d"),l=t.n(r);const a=l()(d,[["render",i]]);o["default"]=a}}]);
//# sourceMappingURL=Comments.5994df64.js.map