(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Comments"],{"0bef":function(e,o,t){"use strict";t.r(o);var s=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.comment,expression:"comment"}],attrs:{type:"text"},domProps:{value:e.comment},on:{keypress:function(o){return!o.type.indexOf("key")&&e._k(o.keyCode,"enter",13,o.key,"Enter")?null:e.addComment(o)},input:function(o){o.target.composing||(e.comment=o.target.value)}}}),t("button",{on:{click:e.addComment}},[e._v("Добавить комментарий")]),t("ul",e._l(e.comments,(function(o){return t("li",{key:o.id},[t("span",[e._v(e._s(o.text))]),t("span",[t("button",{on:{click:function(t){return e.removeComment(o.id)}}},[e._v("удалить")])])])})),0)])},n=[];class i{constructor(e){this.pool=[],this.timeouts=[],this.url=e,this.WSObj=null,this.connected=!1}connect(){this.WSObj=new WebSocket(this.url),this.WSObj.onopen=this.onOpen.bind(this),this.WSObj.onclose=this.onClose.bind(this),this.WSObj.onerror=this.onError.bind(this),this.WSObj.onmessage=this.onMessage.bind(this)}onError(e){console.log("Error:",e);const o=this.pool.findIndex(o=>o.message===e.data);if(o>-1){this.pool[o].onError(e);const t=this.pool[o].TMID;null!==t&&clearTimeout(t),this.pool.splice(o,1)}}onMessage(e){console.log("Message:",e);const o=this.pool.findIndex(o=>o.message===e.data);if(o>-1){const t=this.pool[o];if(t.onSuccess(e),t.timeout){const e=this.timeouts.findIndex(e=>e.messageId===t.messageId);e>-1&&(clearTimeout(this.timeouts[e].timeoutId),this.timeouts.splice(e,1))}this.pool.splice(o,1)}}onOpen(){console.log("Connected"),this.connected=!0}onClose(e){e.wasClean?console.log("Closed"):console.log("Broken"),this.connected=!1}sendMessage(e){if(this.connected){if(this.WSObj.send(e.message),e.timeout){const o=setTimeout(()=>{this.removeFromPoolById(e.messageId),console.log("TIMEOUTED",e.message)},e.timeout);this.timeouts.push({messageId:e.messageId,timeoutId:o})}this.pool.push(e)}else console.error("Socket not connected")}removeFromPoolById(e){const o=this.pool.findIndex(o=>o.messageId===e);o&&this.pool.splice(o,1)}disconnect(){this.WSObj.close()}}class c{constructor({message:e="",onSuccess:o,onError:t,timeout:s=0}={}){this.messageId=Math.round(Date.now()*Math.random()),this.message=e,this.onSuccess="function"===typeof o?o:()=>{},this.onError="function"===typeof t?t:()=>{},this.timeout=s}}var m={name:"Comments",data(){return{comments:[{id:"1",text:"Тестовый коммент 1"},{id:"2",text:"Это шедевр"},{id:"3",text:"Это прекрасно"},{id:"4",text:"Лучшее, что я видел"},{id:"5",text:"Два чая этому автору"}],comment:"",socketMessenger:new i("wss://echo.websocket.org")}},mounted(){this.socketMessenger.connect()},beforeDestroy(){this.socketMessenger.disconnect()},methods:{removeComment(e){this.socketMessenger.sendMessage(new c({message:e,onSuccess:o=>{const t=this.comments.findIndex(o=>o.id===e);t>-1&&this.comments.splice(t,1),console.log("Removed:",o.data)},onError:e=>{console.log("remove comment error:",e)},timeout:500}))},addComment(){this.socketMessenger.sendMessage(new c({message:this.comment,onSuccess:e=>{this.comments.push({id:String(Math.round(1e4*Math.random())),text:e.data}),this.comment=""},onError:e=>{console.log("add comment error:",e)}}))}}},r=m,d=t("2877"),l=Object(d["a"])(r,s,n,!1,null,"458047ee",null);o["default"]=l.exports}}]);
//# sourceMappingURL=Comments.7d616ee5.js.map